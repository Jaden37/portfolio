(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{136:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return m}));var l=t(0),r=t.n(l);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,l,r=function(e,n){if(null==e)return{};var t,l,r={},o=Object.keys(e);for(l=0;l<o.length;l++)t=o[l],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(l=0;l<o.length;l++)t=o[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=r.a.createContext({}),u=function(e){var n=r.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},b=function(e){var n=u(e.components);return r.a.createElement(c.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},p=r.a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,o=e.originalType,a=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),b=u(t),p=l,m=b["".concat(a,".").concat(p)]||b[p]||d[p]||o;return t?r.a.createElement(m,i(i({ref:n},c),{},{components:t})):r.a.createElement(m,i({ref:n},c))}));function m(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var o=t.length,a=new Array(o);a[0]=p;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,a[1]=i;for(var c=2;c<o;c++)a[c]=t[c];return r.a.createElement.apply(null,a)}return r.a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},208:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/longhorn-edit-node-f3ac38b0e542882bedbf95b8d815d570.png"},98:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return i})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return u}));var l=t(3),r=t(7),o=(t(0),t(136)),a={id:"install-longhorn",title:"Install Longhorn"},i={unversionedId:"Kubernetes-Advanced/install-longhorn",id:"Kubernetes-Advanced/install-longhorn",isDocsHomePage:!1,title:"Install Longhorn",description:"Lien vers la documentation officelle//longhorn.io/docs/1.1.0/deploy/install/",source:"@site/docs/Kubernetes-Advanced/install-longhorn.md",slug:"/Kubernetes-Advanced/install-longhorn",permalink:"/docs/Kubernetes-Advanced/install-longhorn",editUrl:"https://github.com/j-peguet/portfolio/blob/master/docs/Kubernetes-Advanced/install-longhorn.md",version:"current",lastUpdatedAt:1618828164,sidebar:"docs",previous:{title:"Install Traefik",permalink:"/docs/Kubernetes-Advanced/install-traefik"},next:{title:"Configure a Master Slave Replication",permalink:"/docs/PostgreSQL/configure-master-slave"}},s=[{value:"Verification du l&#39;infrastrucure",id:"verification-du-linfrastrucure",children:[]},{value:"Installation de Longhorn",id:"installation-de-longhorn",children:[{value:"Pr\xe9requis",id:"pr\xe9requis",children:[]},{value:"R\xe9cup\xe9ration de l&#39;outil",id:"r\xe9cup\xe9ration-de-loutil",children:[]}]},{value:"Ajout de disques sp\xe9cifiques",id:"ajout-de-disques-sp\xe9cifiques",children:[{value:"Ajouter le disque dur",id:"ajouter-le-disque-dur",children:[]},{value:"Formatter le disque",id:"formatter-le-disque",children:[]},{value:"Monter le volume",id:"monter-le-volume",children:[]},{value:"Relancer le service Longhorn",id:"relancer-le-service-longhorn",children:[]}]},{value:"Utiliser Longhorn",id:"utiliser-longhorn",children:[]}],c={toc:s};function u(e){var n=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(l.a)({},c,a,{components:n,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Lien vers la documentation officelle: ",Object(o.b)("a",{parentName:"p",href:"https://longhorn.io/docs/1.1.0/deploy/install/"},"https://longhorn.io/docs/1.1.0/deploy/install/")),Object(o.b)("p",null,"check is longhorn est possible"),Object(o.b)("h3",{id:"verification-du-linfrastrucure"},"Verification du l'infrastrucure"),Object(o.b)("p",null,"Un script est disponible pour v\xe9rifier que l'architecture de votre cluster est compatible avec Longhorn."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"curl -sSfL https://raw.githubusercontent.com/longhorn/longhorn/v1.1.0/scripts/environment_check.sh | bash\n")),Object(o.b)("h2",{id:"installation-de-longhorn"},"Installation de Longhorn"),Object(o.b)("h3",{id:"pr\xe9requis"},"Pr\xe9requis"),Object(o.b)("p",null,"Ces \xe9tapes sont \xe0 faire sur toutes les machines constituant le cluster (les Masters et les Nodes)."),Object(o.b)("h4",{id:"installer-open-iscsi"},"Installer open-iscsi"),Object(o.b)("p",null,"isntaller sur toutes les vms"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"apt-get install open-iscsi\n")),Object(o.b)("h4",{id:"installer-nfsv4-client"},"Installer NFSv4 client"),Object(o.b)("p",null,"Pour les serveurs utilisant Ubuntu ou Debian"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"apt-get install nfs-common\n")),Object(o.b)("p",null,"Pour RHEL, CentOS et EKS"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"yum install nfs-utils\n")),Object(o.b)("h4",{id:"version-de-kubernetes"},"Version de Kubernetes"),Object(o.b)("p",null,"Utilisez cette commande pour v\xe9rifier votre version de Kubernetes."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"sudo kubectl version\n")),Object(o.b)("p",null,"La ",Object(o.b)("code",null,"Server Version")," doit \xeatre de ",Object(o.b)("code",null,"v1.16")," ou sup\xe9rieure."),Object(o.b)("h3",{id:"r\xe9cup\xe9ration-de-loutil"},"R\xe9cup\xe9ration de l'outil"),Object(o.b)("p",null,"Nous allons cr\xe9er un dossier contenant les fichiers de configuration de Longhorn. Puis t\xe9l\xe9charger et ex\xe9cuter les fichiers yaml."),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"https://longhorn.io/docs/1.1.0/deploy/install/install-with-kubectl/"},"https://longhorn.io/docs/1.1.0/deploy/install/install-with-kubectl/")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"mkdir longhorn\ncd longhorn\nwget https://raw.githubusercontent.com/longhorn/longhorn/v1.1.0/deploy/longhorn.yaml\n\nsudo kubectl apply -f longhorn.yaml\n")),Object(o.b)("p",null,"Pour v\xe9rifier que l'installation se d\xe9roule correctement, tous les pods doivent avoir le status ",Object(o.b)("code",null,"Running"),"."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods --namespace longhorn-system --watch\n")),Object(o.b)("h2",{id:"ajout-de-disques-sp\xe9cifiques"},"Ajout de disques sp\xe9cifiques"),Object(o.b)("p",null,"Cette \xe9tape est optionnelle, mais ",Object(o.b)("strong",{parentName:"p"},"fortement recommand\xe9e"),". Elle vise \xe0 ajouter des disques durs sp\xe9cique \xe0 longhorn (\xe0 faire sur chaque Node)."),Object(o.b)("h3",{id:"ajouter-le-disque-dur"},"Ajouter le disque dur"),Object(o.b)("p",null,"Ajout un disque dur sur votre Machine de mani\xe8re physique ou logique, dans cet exemple 20Go seront ajout\xe9."),Object(o.b)("h3",{id:"formatter-le-disque"},"Formatter le disque"),Object(o.b)("p",null,"Lien compl\xe9mentaire ici: ",Object(o.b)("a",{parentName:"p",href:"https://www.tecmint.com/add-new-disk-to-an-existing-linux/"},"https://www.tecmint.com/add-new-disk-to-an-existing-linux/")),Object(o.b)("p",null,"Lister tous les disques de votre systemes et s\xe9lectionner le nouveau disque, g\xe9n\xe9ralement /dev/sdb."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"fdisk -l\nfdisk /dev/sdb\n")),Object(o.b)("p",null,"Dans le menu fdisk s\xe9lectionner ",Object(o.b)("code",null,"n")," et ",Object(o.b)("code",null,"p")," pour cr\xe9er et d\xe9clarer la nouvelle partition comme partition principale."),Object(o.b)("p",null,"Puis ",Object(o.b)("code",null,"w")," pour sauvegarder la configuration."),Object(o.b)("p",null,"Formatage du disque en ext4."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"mfs.ext4  /dev/sdb\n")),Object(o.b)("h3",{id:"monter-le-volume"},"Monter le volume"),Object(o.b)("p",null,"Maintenant que le volume est cr\xe9er, nous allons le monter automatiquement \xe0 chaque d\xe9marrage de la machine."),Object(o.b)("p",null,"Nous cr\xe9ons un dossier ",Object(o.b)("code",null,"/mnt/longhorn")," qui sera l'emplacement de notre nouveau disque."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"sudo mkdir /mnt/longhorn\nmount /dev/sdb1 /mnt/longhorn\n")),Object(o.b)("p",null,"Rajouter la ligne dans ",Object(o.b)("code",null,"/etc/fstab")," pour monter la partition lors du boot."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"/dev/sdb1 /mnt/longhorn ext4 defaults 0 0\n")),Object(o.b)("h3",{id:"relancer-le-service-longhorn"},"Relancer le service Longhorn"),Object(o.b)("p",null,"Modifier dans le fichier ",Object(o.b)("code",null,"longhorn.yaml"),"."),Object(o.b)("p",null,'Allez dans le ConfigMap "longhorn-default-setting" et modifier les lignes ci-dessous.'),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"create-default-disk-labeled-nodes: true\ndefault-data-path: /mnt/longhorn/\n")),Object(o.b)("p",null,"Puis appliquer les modifications du fichier."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"sudo kubectl apply -f longhorn.yaml\n")),Object(o.b)("p",null,"Il faut ensuite ajouter les disques \xe0 la configuration de Longhorn. Acc\xe9der au portail via le service longhorn-frontend."),Object(o.b)("p",null,"Dans le dashboard Longhorn editer la node et ajouter le disk en renseignant:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"nom"),Object(o.b)("li",{parentName:"ul"},"espace"),Object(o.b)("li",{parentName:"ul"},"path (/mnt/longhorn)"),Object(o.b)("li",{parentName:"ul"},"enable le disk")),Object(o.b)("p",null,Object(o.b)("img",{alt:"longhorn edit node",src:t(208).default})),Object(o.b)("p",null,"Les disques doivent avoir le status Schedulable."),Object(o.b)("p",null,"F\xe9liciations \ud83c\udf89 !! L'installation de Longhorn est finie (\xe0 vous les joies du stockage distribu\xe9)."),Object(o.b)("h2",{id:"utiliser-longhorn"},"Utiliser Longhorn"),Object(o.b)("p",null,"Pour utiliser le service Longhorn, lors de la cr\xe9ation d'un pvc il suffit de sp\xe9cifier le service comme dans l'exemple ci-dessous."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-yaml"},"storageClass: longhorn\n")))}u.isMDXComponent=!0}}]);