(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{118:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return i}));var a=n(3),r=n(7),o=(n(0),n(136)),s={id:"setup-vm",title:"Setup VM"},c={unversionedId:"Kubernetes-Advanced/setup-vm",id:"Kubernetes-Advanced/setup-vm",isDocsHomePage:!1,title:"Setup VM",description:"Une configuration diff\xe9rente du tuto Getting and Installing Kubernetes on Ubuntu VMs va \xeatre utilis\xe9.",source:"@site/docs/Kubernetes-Advanced/setup-vm.md",slug:"/Kubernetes-Advanced/setup-vm",permalink:"/docs/Kubernetes-Advanced/setup-vm",editUrl:"https://github.com/j-peguet/portfolio/blob/master/docs/Kubernetes-Advanced/setup-vm.md",version:"current",lastUpdatedAt:1618828164,sidebar:"docs",previous:{title:"Manually Scheduling a Pod",permalink:"/docs/Kubernetes/3_kubernetes_storage_&_scheduling/8_5_Manually_Scheduling"},next:{title:"Install Calico",permalink:"/docs/Kubernetes-Advanced/install-calico"}},l=[{value:"Installation des packages",id:"installation-des-packages",children:[]},{value:"Modification des Nodes",id:"modification-des-nodes",children:[]}],u={toc:l};function i(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Une configuration diff\xe9rente du tuto ",Object(o.b)("a",{parentName:"p",href:"/docs/Kubernetes/1_install_&_configuration/1_install_VM"},"Getting and Installing Kubernetes on Ubuntu VMs")," va \xeatre utilis\xe9."),Object(o.b)("p",null,"L'id\xe9al est de partir de machines vierges."),Object(o.b)("p",null,"Ces \xe9tapes sont \xe0 faire sur toutes les machines constituant le cluster (les Masters et les Nodes)."),Object(o.b)("h3",{id:"installation-des-packages"},"Installation des packages"),Object(o.b)("p",null,"Update des packages ",Object(o.b)("code",null,"apt"),"."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"sudo apt-get update\nsudo apt-get install -y apt-transport-https ca-certificates curl\n")),Object(o.b)("p",null,"Ajout de la cl\xe9 publique Google et du repository Kubernetes."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},'sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg\necho "deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee /etc/apt/sources.list.d/kubernetes.list\n')),Object(o.b)("p",null,"Mise \xe0 jour de l'index apt et installation des packages kubelet, kubeadm, kubectl et docker.io.\nNe pas oublier de bloquer la version des packages."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"sudo apt-get update\nsudo apt-get install -y kubelet kubeadm kubectl docker.io\nsudo apt-mark hold kubelet kubeadm kubectl docker.io\n")),Object(o.b)("h3",{id:"modification-des-nodes"},"Modification des Nodes"),Object(o.b)("p",null,"Dans le fichier ",Object(o.b)("code",null,"/etc/sysctl.conf"),", d\xe9commenter la ligne ",Object(o.b)("code",null,"net.ipv4.ip_forward=1"),". Afin de permettre la communication et la r\xe9partition des pods entres les nodes."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/sysctl.conf\n")),Object(o.b)("p",null,"Pour installer kubernetes il faut imp\xe9rativement d\xe9sactiver le swap de la machine."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"sudo swapoff -a\n")),Object(o.b)("p",null,"Et modifier le fichier ",Object(o.b)("code",null,"/etc/fstab")," pour interdire \xe0 la machine de monter le Swap lors du boot.\nCommenter la ligne ",Object(o.b)("code",null,"/swap.img     none    swap    sw      0       0")," (exemple pour Debian)."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/fstab\n")),Object(o.b)("p",null,"Reboot de la VM."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-bash"},"sudo reboot\n")))}i.isMDXComponent=!0},136:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=r.a.createContext({}),i=function(e){var t=r.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=i(e.components);return r.a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=i(n),b=a,m=p["".concat(s,".").concat(b)]||p[b]||d[b]||o;return n?r.a.createElement(m,c(c({ref:t},u),{},{components:n})):r.a.createElement(m,c({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=b;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,s[1]=c;for(var u=2;u<o;u++)s[u]=n[u];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);